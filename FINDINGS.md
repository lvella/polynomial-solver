# Satisfiability of Systems of Polynomial (In)Equations in Prime Field

Given a system of polynomial statements, like the following:
$$
4x^3 + 2x^2y^2 + 12x - y = 5 \\
y^3 - 3x^2 \neq 7xy^3 +1,
$$
the goal is to find if there is an evaluation of the variables ($x$ and $y$ in this case) in a field
mod some prime $p$ where all the statements are true. This can be eventually integrated into a SMT
solver, like Z3, and be used to prove statements about zkSNARKs circuits, as generated by ZoKrates.

It seems that inequations of the kind $x^2~\le~y$ does not really make sense in a mod $p$ field,
because the values wrap around, so a total ordering among the elements is not really meaningfully defined for most applications of the satisfiability solver. Alternatively, ranges of the kind
$a~\le~x^2~-~y~\lt~b$ looks much more useful, but I am not sure they will be in the scope of this
work, because I do not know if they would be useful for the goal of proving statements about zkSNARKs
circuits.

## Turning into a system of equations with restriction to variables

We can introduce a new variable $z$ and rewrite the previously stated inequation into a set of
equations $= 0$, plus a set of restrictions on the variables themselves:
$$
4x^3 + 2x^2y^2 + 12x - y - 5 = 0\\
y^3 - 3x^2 - 7xy^3 - z = 0\\
z \ne 1
$$

The problem is then reduced to the problem of finding the common roots for a set of polynomials (that
belongs in the prime field, obviously, because roots of polynomials may not be defined in the same set as the coefficients, for instance $x^2~-~2~=~0$ has no solution in integers and $x^2~+~2~=~0$ has no solution in reals) and exclude all solutions that does not match the variables restrictions.

## Solving a system of polynomial equation

The subproblem of deciding the roots of a system of multivariate non-linear polynomial equations can
be solved by finding the minimal Gröbner basis in lexicographical order of the set of polynomials.
This will yield a new set of polynomials with the same roots, but in a triangular format, i.e. that
can be solved one variable a time, so that the first polynomial has only one variable, and the next
polynomial can be solved by replacing the variables already found previously, yielding another one
variable polynomial. The best know algorithms for finding Gröbner basis are Faugère's F4 and F5
algorithms, and they have exponential complexity on the worst case.

As mentioned the Gröbner basis is defined for a total order among the monomials (i.e. the variable
product power parts like $x^3y^2$), which implies a total order among the variables themselves.
If we define $x < y < z < 1$ (one must always be the smallest), them the first variable that can be
solved is $z$, then $y$, then $x$. As you can see in the Gröbner basis of the example above:

TODO...

Finding the roots of a univariate polynomial in a prime field is relatively cheap, with the best known
algorithm being factorizing the polynomial into unique factors $(x - a_1)(x - a_2)...(x - a_n)$ where
$a_i$ are the roots of the polynomial. The most efficient algorithm for factorization in a prime
field is called Cantor-Zassenhaus algorithm, with complexity $O(d^3 \log p)$ where $d$ is the degree
of the polynomial and $p$ is the prime field's prime.

Having the system in triangular format and the algorithm to find the roots one variable at a time,
we have a branching problem, where each variable assignment will lead to a new set of possible
assignments for the next variable, and so on, so that the naïve search expands into a typical NP
problem.

To cut down the search tree as early as possible, I conjecture it is best to order the variables with
the most inequality restrictions as lowest in the Gröbner basis ordering, so that roots that
violates the restrictions are pruned earliest.

In linear systems, the search can be reduced by looking at the bounds of the variables with the
SIMPLEX algorithm, so maybe there is a SIMPLEX generalization that works here to speed-up the search,
but I find it unlikely, as SIMPLEX works by iteratively restricting the convex search space limited
by straight lines/hyperplanes, but the curves designated by non-linear polynomials are not planes, so
the limited space will not be convex.

## Alternative method for the case where there are no inequalities restrictions

If there are no inequalities in the system, the satisfiability problem can be solved by finding
the Gröbner basis of the system extended with the equations
$$
x^p - x = 0
$$
for each variable $x$ in the system, as per Fermat's little theorem, $x^p = x \mod p$.

For instance, for the system:
$$
4x^3 + 2x^2y^2 + 12x - y - 5 = 0\\
y^3 - 3x^2 - 7xy^3 - z = 0\\
$$
the new equations would be:
$$
x^p - x = 0\\
y^p - y = 0\\
z^p - z = 0
$$
where $p$ is the prime of the field.

The Gröbner basis of the extended set will contain a constant iff the system is unsatisfiable. Such Gröbner basis can be calculated using any monomial ordering, like degree reverse lexicographical order, which is cheaper to calculate than the lexicographical order.

That said, if $p \gg 0$, the procedure to calculate such Gröbner basis might be prohibitively
expensive due to the worst case complexity being a function of $d^2$, where $d$ is the highest power
in the system, and the method of solving each root individually might be cheaper.